---

title: Title
keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01-demo2.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>The email portion of this campaign was actually run as an A/B test. Half the emails sent out were generic upsells to your product while the other half contained personalized messaging around the users’ usage of the site.</p>
</blockquote>
<p>这是 AB Test 的实验内容。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="conversion_rate" class="doc_header"><code>conversion_rate</code><a href="https://github.com/fastai/conversion_metrics/tree/master/conversion_metrics/ratio.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>conversion_rate</code>(<strong><code>dataframe</code></strong>, <strong><code>column_names</code></strong>, <strong><code>converted</code></strong>=<em><code>'converted'</code></em>, <strong><code>id_name</code></strong>=<em><code>'user_id'</code></em>)</p>
</blockquote>
<p>Calculate conversion rate.
Cite <a href="https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas">https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas</a></p>
<h2 id="Parmaters">Parmaters<a class="anchor-link" href="#Parmaters">&#182;</a></h2><p>dataframe: pandas.DataFrame
column_names: str
    The conlumn(s) chosen to partition groups to
    calculate conversion rate.
converted: str
    The column with True and False to determine
    whether users are converted.
id_name: str
    The column saved user_id.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns">&#182;</a></h2><p>conversion_rate: conversion rate</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">marketing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/marketing.csv&quot;</span><span class="p">,</span>
                        <span class="n">parse_dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_served&#39;</span><span class="p">,</span> <span class="s1">&#39;date_subscribed&#39;</span><span class="p">,</span> <span class="s1">&#39;date_canceled&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Subset the DataFrame</span>
<span class="n">email</span> <span class="o">=</span> <span class="n">marketing</span><span class="p">[</span><span class="n">marketing</span><span class="o">.</span><span class="n">marketing_channel</span> <span class="o">==</span> <span class="s1">&#39;Email&#39;</span><span class="p">]</span>

<span class="c1"># Group the email DataFrame by variant </span>
<span class="n">alloc</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;variant&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="c1"># Plot a bar chart of the test allocation</span>
<span class="n">alloc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Personalization test allocation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;# participants&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>差异不大。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Group marketing by user_id and variant</span>
<span class="n">subscribers</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> 
                             <span class="s1">&#39;variant&#39;</span><span class="p">])[</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">subscribers_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">subscribers</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> 

<span class="c1"># Drop missing values from the control column</span>
<span class="n">control</span> <span class="o">=</span> <span class="n">subscribers_df</span><span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Drop missing values from the personalization column</span>
<span class="n">personalization</span> <span class="o">=</span> <span class="n">subscribers_df</span><span class="p">[</span><span class="s1">&#39;personalization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Control conversion rate:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">control</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Personalization conversion rate:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">personalization</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Control conversion rate: 0.2814814814814815
Personalization conversion rate: 0.3908450704225352
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>这种 Python 写法我觉得有点复杂。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
$$\begin{array}{l}{\text { Calculating lift: }} \\ {\qquad \frac{\text { Treatment conversion rate - Control conversion rate }}{\text { Control conversion rate }}}\end{array}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>注意这里的 lift 是转化率的比较，因此是可以超过 100 %</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lift" class="doc_header"><code>lift</code><a href="https://github.com/fastai/conversion_metrics/tree/master/conversion_metrics/ratio.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lift</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>sig</code></strong>=<em><code>2</code></em>)</p>
</blockquote>
<p>Calculate lift statistic for an AB test.
Cite <a href="https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas">https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas</a></p>
<h2 id="Parmaters">Parmaters<a class="anchor-link" href="#Parmaters">&#182;</a></h2><p>a: float.
    control group.
b: float.
    test group.
sig: integer.
    default 2.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns">&#182;</a></h2><p>lift: lift statistic</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lift</span><span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">personalization</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;38.853%&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#26597;&#30475;&#26159;&#21542;&#32479;&#35745;&#26174;&#33879;">&#26597;&#30475;&#26159;&#21542;&#32479;&#35745;&#26174;&#33879;<a class="anchor-link" href="#&#26597;&#30475;&#26159;&#21542;&#32479;&#35745;&#26174;&#33879;">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lift_sig" class="doc_header"><code>lift_sig</code><a href="https://github.com/fastai/conversion_metrics/tree/master/conversion_metrics/ratio.py#L79" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lift_sig</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>
<p>Calculate lift statistical significance for an AB test.
Cite <a href="https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas">https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas</a></p>
<h2 id="Parmaters">Parmaters<a class="anchor-link" href="#Parmaters">&#182;</a></h2><p>a: float.
    control group.
b: float.
    test group.
sig: integer.
    default 2.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns">&#182;</a></h2><p>lift: lift statistic</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t_value</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">lift_sig</span><span class="p">(</span><span class="n">control</span><span class="p">,</span><span class="n">personalization</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The t value of  the two variables is -0.577  with p value 0.580
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>In the next lesson, you will explore whether that holds up across all demographics.</p>
</blockquote>
<p>这真是做 AB test 一个成熟的思维，不代表每一个 group 都很好。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ab_test" class="doc_header"><code>ab_test</code><a href="https://github.com/fastai/conversion_metrics/tree/master/conversion_metrics/ratio.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ab_test</code>(<strong><code>df</code></strong>, <strong><code>segment</code></strong>, <strong><code>id_name</code></strong>=<em><code>'user_id'</code></em>, <strong><code>test_column</code></strong>=<em><code>'variant'</code></em>, <strong><code>converted</code></strong>=<em><code>'converted'</code></em>)</p>
</blockquote>
<p>Calculate lift statistic by segmentation.
Cite <a href="https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas">https://www.datacamp.com/courses/analyzing-marketing-campaigns-with-pandas</a></p>
<h2 id="Parmaters">Parmaters<a class="anchor-link" href="#Parmaters">&#182;</a></h2><p>df: pandas.DataFrame.</p>
<p>segment: str.
    group column.</p>
<p>id_name: user_id</p>
<p>test_column: str
    The column indentify test or ctrl groups.</p>
<p>converted: logical.
    Whether converted or not.</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns">&#182;</a></h2><p>lift: lift statistic</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">marketing</span><span class="p">[</span><span class="n">marketing</span><span class="p">[</span><span class="s1">&#39;marketing_channel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Email&#39;</span><span class="p">]</span>
<span class="n">ab_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">segment</span><span class="o">=</span><span class="s1">&#39;language_displayed&#39;</span><span class="p">,</span> <span class="n">id_name</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="n">test_column</span><span class="o">=</span><span class="s1">&#39;variant&#39;</span><span class="p">,</span> <span class="n">converted</span><span class="o">=</span><span class="s1">&#39;converted&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Group - Arabic: 
lift: 50.0%
The t value of  the two variables is -0.577  with p value 0.580
Group - English: 
lift: 39.0%
The t value of  the two variables is -2.218  with p value 0.027
Group - German: 
lift: -1.62%
The t value of  the two variables is 0.191  with p value 0.849
Group - Spanish: 
lift: 166.67%
The t value of  the two variables is -2.357  with p value 0.040
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>date_served</th>
      <th>marketing_channel</th>
      <th>variant</th>
      <th>converted</th>
      <th>language_displayed</th>
      <th>language_preferred</th>
      <th>age_group</th>
      <th>date_subscribed</th>
      <th>date_canceled</th>
      <th>subscribing_channel</th>
      <th>is_retained</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>354</th>
      <td>a100000526</td>
      <td>2018-01-01</td>
      <td>Email</td>
      <td>personalization</td>
      <td>True</td>
      <td>Arabic</td>
      <td>Arabic</td>
      <td>0-18 years</td>
      <td>2018-01-01</td>
      <td>NaT</td>
      <td>Email</td>
      <td>True</td>
    </tr>
    <tr>
      <th>358</th>
      <td>a100000530</td>
      <td>2018-01-05</td>
      <td>Email</td>
      <td>personalization</td>
      <td>True</td>
      <td>Arabic</td>
      <td>Arabic</td>
      <td>19-24 years</td>
      <td>2018-01-05</td>
      <td>NaT</td>
      <td>Email</td>
      <td>True</td>
    </tr>
    <tr>
      <th>362</th>
      <td>a100000534</td>
      <td>2018-01-09</td>
      <td>Email</td>
      <td>personalization</td>
      <td>False</td>
      <td>English</td>
      <td>English</td>
      <td>45-55 years</td>
      <td>2018-01-09</td>
      <td>NaT</td>
      <td>Email</td>
      <td>True</td>
    </tr>
    <tr>
      <th>366</th>
      <td>a100000538</td>
      <td>2018-01-13</td>
      <td>Email</td>
      <td>personalization</td>
      <td>True</td>
      <td>Arabic</td>
      <td>Arabic</td>
      <td>24-30 years</td>
      <td>2018-01-13</td>
      <td>2018-01-23</td>
      <td>Email</td>
      <td>False</td>
    </tr>
    <tr>
      <th>370</th>
      <td>a100000542</td>
      <td>2018-01-17</td>
      <td>Email</td>
      <td>personalization</td>
      <td>True</td>
      <td>English</td>
      <td>English</td>
      <td>0-18 years</td>
      <td>2018-01-17</td>
      <td>2018-02-12</td>
      <td>Email</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Often treatment will not affect all people uniformly. Some people will love a particular marketing campaign while others hate it. As a marketing data scientist, it's your responsibility to enable your marketing stakeholders to target users according to their preferences.</p>
</blockquote>

</div>
</div>
</div>
</div>
 

